<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
    <title>Intermed - Documents</title>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="favicon.ico">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
    <!-- Plugins CSS -->
    <link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.css">
    <link rel="stylesheet" href="assets/plugins/prism/prism.css">
    <link rel="stylesheet" href="assets/plugins/lightbox/dist/ekko-lightbox.min.css">
    <link rel="stylesheet" href="assets/plugins/elegant_font/css/style.css">

    <!-- Theme CSS -->
    <link id="theme-style" rel="stylesheet" href="assets/css/styles.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body class="body-blue">
    <div class="page-wrapper">
        <!-- ******Header****** -->
        <header id="header" class="header">
            <div class="container">
                <div class="branding">
                    <h1 class="logo">
                        <a href="index.html">
                            <span aria-hidden="true" class="icon_documents_alt icon"></span>
                            <span class="text-bold">Intermed</span>
                        </a>
                    </h1>
                </div><!--//branding-->
                <ol class="breadcrumb">
                    <li><a href="index.html">Home</a></li>
                    <li class="active">Quick Start</li>
                </ol>
            </div><!--//container-->
        </header><!--//header-->
        <div class="doc-wrapper">
            <div class="container">
                <div id="doc-header" class="doc-header text-center">
                    <h1 class="doc-title"><i class="icon fa fa-paper-plane"></i> Quick Start</h1>
                </div><!--//doc-header-->
                <div class="doc-body">
                    <div class="doc-content">
                        <div class="content-inner">
                            <section id="intro-section" class="doc-section">
                                <h2 class="section-title">Intermed GitFlow</h2>
                                <div class="section-block">
                                    <p>Para el control de versiones de software se utilizo GitHub y un esquema similar al GitFlow, el cual se explica a continuacion:</p>
                                    <div class="screenshot-holder">
                                        <a data-toggle="lightbox" data-title="Intermed - GitFlow" href="assets/images/intermed/gitflow.png">
                                            <img class="img-responsive" src="assets/images/intermed/gitflow.png" alt="Intermed GitFlow">
                                        </a>
                                        <a class="mask" href="assets/images/intermed/gitflow.png" data-title="Intermed - GitFlow" data-toggle="lightbox"><i class="icon fa fa-search-plus"></i></a>
                                    </div>

                                </div>
                            </section><!--//doc-section-->
                            <section id="installation-section" class="doc-section">
                                <h2 class="section-title">Instalación</h2>
                                <div id="step1"  class="section-block">
                                    <h3 class="block-title">Paso 1</h3>
                                    <p>Descargar el repositorio en .zip o clonarlo con git.</p>
                                    <a class="btn btn-green btn-cta" href="https://github.com/NewChannelMedia/intermed" target="_blank"><i class="fa fa-github"></i> Descargar Repositorio</a>
                                    <br>
                                    <div class="code-block">
                                        <h6>Comando para realizar el clon:</h6>
                                        <p><code>git clone https://github.com/NewChannelMedia/intermed.git</code></p
                                    </div><!--//code-block-->
                                </div><!--//section-block-->
                                <div id="step2"  class="section-block">
                                    <h3 class="block-title">Paso 2</h3>
                                    <p>Desde terminal entrar a la carpeta del repositorio y acceder al branch 'development'.
                                    </p>
                                    <p><code>cd intermed</code></p>
                                    <p><code>git checkout development</code></p>
                                </div><!--//section-block-->
                                <div id="step3"  class="section-block">
                                    <h3 class="block-title">Paso 3</h3>
                                    <p>Descargar y Montar la base de datos.
                                    </p>
                                    <a class="btn btn-green btn-cta" href="https://drive.google.com/file/d/0B4ythbeicegOQTM1ZVFLRHlWbVk/view?usp=sharing" target="_blank"><i class="fa fa-cloud-download"></i> Descargar Base de Datos</a>
                                </div><!--//section-block-->
                            </section><!--//doc-section-->
                            <section id="server-section" class="doc-section">
                                <h2 class="section-title">Server</h2>
                                <div id="node" class="section-block">
                                    <p>
                                        <a href="https://nodejs.org/es/" target="_blank">NodeJS</a> es la tecnologìa de servidor utilizada en este proyecto. Se puede iniciar el proyecto de la manera convencional o utlizando un demon para mantener el server encendido aun despues de realizar cambios en el proyecto. Recomendamos usar <a href="https://nodemon.io/" target="_blank">Nodemon.io</a>.
                                    </p>
                                    <div class="code-block">
                                        <p><code>node app.js</code></p>
                                        <br/>
                                        <p>
                                            O usando el demon:
                                        </p>
                                        <p><code>nodemon app.js</code></p>
                                    </div>
                                </div><!--//section-block-->
                            </section>
                            <section id="mvc-section" class="doc-section">
                                <h2 class="section-title">Intermed MVC</h2>
                                <div class="section-block">
                                    <p>La infraestructura de la plataforma de Intermed esta basada en <a href="http://expressjs.com/es/">Express.js</a>.
                                        El hecho de que Express sea una infraestructura flexible nos permitio moficar su nucleo y extender algunas funcionalidades.
                                    </p>
                                    <p>Gracias a esto terminamos estructurado la base del sistema de la siguiente manera:
                                    </p>
                                    <img class="img-responsive" src="assets/images/intermed/screenmvc.png" alt="Intermed GitFlow">
                                </div>
                                <div id="appjs" class="section-block">
                                    <div class="code-block">
                                        <h6>App.js</h6>
                                        <p>App.js este archivo sera el principal de toda la aplicación.
                                        Aquí solo se ejecutaran comandos para hacer el llamado de otros archivos.</p>
                                        <pre><code class="language-javascript">var arranca = require( &#x27;./config/router&#x27; );</code></pre>
                                    </div><!--//code-block-->
                                </div><!--//section-block-->

                                <div id="routerjs" class="section-block">
                                    <div class="code-block">
                                        <h6>Router.js</h6>
                                        <p>Este archivo es el encargado de hacer la logica de las rutas para las diferentes url que se van a estar mandando por get
                                        o por post, según sea el caso.</p>
                                        <p>Estara trabajando dentro de una funcion donde esta se podrá exportar
                                        para su manejo en cualquier otro archivo js.</p>
                                        <p>Este archivo llamando al servidor de express.</p>
                                        <pre><code class="language-javascript">global.base_url = &#x27;http://localhost:3000/&#x27;;

var express = require( &#x27;express&#x27; ),
    exphbs = require( &#x27;express-handlebars&#x27; ),
    handlebars = require( &#x27;handlebars&#x27; ),
    serv = require( &#x27;./server&#x27; ),
    socket = require( &#x27;./io&#x27; ),
    url = require( &#x27;url&#x27; ),
    passport = require( &#x27;passport&#x27; ),
    bodyParser = require( &#x27;body-parser&#x27; ),
    cookieParser = require( &#x22;cookie-parser&#x22; ),
    session = require( &#x27;express-session&#x27; ),
    bundle = require( &#x27;socket.io-bundle&#x27; ),
    ioPassport = require( &#x27;socket.io-passport&#x27; ),
    hps = require( &#x27;../apps/helpers/helpers&#x27; ),
    intermed = require( &#x27;../apps/controllers/Intermed&#x27; ),
    errorHandler = require( &#x27;../apps/controllers/errorHandler&#x27; ),
    models = require( &#x27;../apps/models&#x27; );

require( &#x27;./configPassport&#x27; )( passport );

var app = express()
    .use( cookieParser( &#x27;_intermed&#x27; ) )
    .use( session( {
        secret: &#x27;_intermed&#x27;,
        resave: true,
        saveUninitialized: true
    } ) )
    .use( passport.initialize() )
    .use( passport.session() )
    .use( bodyParser.json( {
        limit: &#x27;5mb&#x27;
    } ) ) // support json encoded bodies
    .use( bodyParser.urlencoded( {
        extended: true,
        limit: &#x27;5mb&#x27;
    } ) ); // support encoded bodies

app.set( &#x27;view engine&#x27;, &#x27;hbs&#x27; );
app.use( &#x27;/&#x27;, express.static( __dirname + &#x27;/../public&#x27; ) );
app.use( &#x27;/:a&#x27;, express.static( __dirname + &#x27;/../public&#x27; ) );
app.use( &#x27;/:a/&#x27;, express.static( __dirname + &#x27;/../public&#x27; ) );
app.use( &#x27;/:a/:b&#x27;, express.static( __dirname + &#x27;/../public&#x27; ) );
app.use( &#x27;/:a/:b/&#x27;, express.static( __dirname + &#x27;/../public&#x27; ) );

var routeDispatcher = function ( plantilla, carpeta, helpers ) {
    app.set( &#x27;views&#x27;, __dirname + &#x27;/../apps/views/&#x27; + carpeta );
    app.engine( &#x27;hbs&#x27;, exphbs( {
        defaultLayout: __dirname + &#x27;/../apps/views/layouts/&#x27; +
            plantilla + &#x27;.hbs&#x27;,
        extname: &#x27;.hbs&#x27;,
        helpers: helpers
    } ) );
}

/*INICIO CARGA DE ROUTERS*/
var routerObject = {
    app: app,
    intermed: intermed,
    routeDispatcher: routeDispatcher,
    hps: hps,
    express: express,
    passport: passport,
    url: url,
    models: models,
    errorHandler: errorHandler
}
app.all( &#x27;*&#x27;, function ( req, res, next ) {
    if ( req.method == &#x22;GET&#x22; )
        console.log( req.method + &#x27;_&#x27; + req.path + &#x27;: &#x27; + JSON.stringify(
            req.cookies[ &#x27;_intermed&#x27; ] ) );
    next();
} );

//::Temporal::, solo para ver la informaci&#xF3;n que tiene el usuario en su variable sesi&#xF3;n
app.get( &#x27;/informacionusuario&#x27;, function ( req, res ) {
    //res.send( JSON.stringify( req.session.passport ) + &#x27;&#x3C;br/&#x3E;&#x3C;a href=&#x22;/&#x22;&#x3E;Regresar&#x3C;/a&#x3E;&#x27; )
    res.send( JSON.stringify( req.session.passport ) );
} );

function parseCookies( request ) {
    var list = {},
        rc = request.headers.cookie;

    rc &#x26;&#x26; rc.split( &#x27;;&#x27; ).forEach( function ( cookie ) {
        var parts = cookie.split( &#x27;=&#x27; );
        list[ parts.shift().trim() ] = decodeURI( parts.join( &#x27;=&#x27; ) );
    } );

    return list;
}
//Fin temporal

require( &#x27;./routers/router-sesion.js&#x27; )( routerObject ); //Es el primero en cargar, verifica la sesi&#xF3;n
require( &#x27;./routers/_router-get.js&#x27; )( routerObject ); //Contiene todas las rutas a cargar (render)
require( &#x27;./routers/router-buscador.js&#x27; )( routerObject );
require( &#x27;./routers/router-contactos.js&#x27; )( routerObject );
require( &#x27;./routers/router-agenda.js&#x27; )( routerObject );
require( &#x27;./routers/router-inbox.js&#x27; )( routerObject );
require( &#x27;./routers/router-medico.js&#x27; )( routerObject );
require( &#x27;./routers/router-notificaciones.js&#x27; )( routerObject );
require( &#x27;./routers/router-paciente.js&#x27; )( routerObject );
require( &#x27;./routers/router-ubicacion.js&#x27; )( routerObject );
require( &#x27;./routers/router-usuario.js&#x27; )( routerObject );
require( &#x27;./routers/router-encriptacion.js&#x27; )( routerObject );
require( &#x27;./routers/router-configuraciones.js&#x27; )( routerObject ); //router para las configuraciones
require( &#x27;./routers/router-control.js&#x27; )( routerObject );
require( &#x27;./routers/router-pagos.js&#x27; )( routerObject );
require( &#x27;./routers/router-historiales.js&#x27; )( routerObject );
require( &#x27;./routers/router-secretaria.js&#x27; )( routerObject );
require( &#x27;./routers/router-error.js&#x27; )( routerObject );
/*FIN CARGA DE ROUTERS*/

var io = serv.server( app, 3000 );
socket.io( io, bundle, ioPassport );</code></pre>
                                    </div><!--//code-block-->
                                </div><!--//section-block-->
                                <div id="serverjs" class="section-block">
                                    <div class="code-block">
                                        <h6>Server.js</h6>
                                        <p>Arranca el servidor en el puerto especificado desde Router.js</p>
                                        <pre><code class="language-javascript">var server = function ( ap, port ) {
  return require( 'socket.io' ).listen( ap.listen( port ) );
};

//se importa para que otros js lo puedan ejecutar
exports.server = server;</code></pre>
                                    </div><!--//code-block-->
                                </div><!--//section-block-->
                                <div id="iojs" class="section-block">
                                    <div class="code-block">
                                        <h6>Io.js</h6>
                                        <p>Tiene funciones para iniciar sesiones y para iniciar servicios de sockets.</p>
                                        <pre><code class="language-javascript">var intermed = require( &#x27;../apps/controllers/Intermed&#x27; );
var models = require( &#x27;../apps/models&#x27; );

const crypto = require( &#x27;crypto&#x27; ),
    algorithm = &#x27;aes192&#x27;,
    password = &#x27;int5erm7edS6ess6ion&#x27;;

var io = function ( io, bundle, ioPassport ) {
    io.use( bundle.cookieParser() );
    io.use( bundle.session( {
        secret: &#x27;my secret&#x27;
    } ) );
    io.use( ioPassport.initialize() );
    io.use( ioPassport.session() );

    var conectados = [];

    function indexOf( id ) {
        var index = 0;
        var indexenviar = -1;
        conectados.forEach( function ( record ) {
            if ( record.socket == id ) {
                indexenviar = index;
            } else index++;
        } );
        return indexenviar;
    }

    function indexOfUsuarioId( id ) {
        var index = 0;
        var indexenviar = [];
        conectados.forEach( function ( record ) {
            if ( record.id == id ) {
                indexenviar.push( record.socket );
            }
        } );
        return indexenviar;
    }

    function desconectar( id ) {
        var index = indexOf( id );
        if ( index &#x3E;= 0 ) {
            conectados.splice( index, 1 );
            return true;
        } else {
            return false;
        }
    }

    function intermed_sesion( socket ) {
        var _intermed = {};
        try {
            var encrypted = unescape( socket.request.cookies[ &#x27;_intermed&#x27; ] ).toString();
            var decipher = crypto.createDecipher( algorithm, password );
            var decrypted = decipher.update( encrypted, &#x27;hex&#x27;, &#x27;utf8&#x27; );
            decrypted += decipher.final( &#x27;utf8&#x27; );
            cookieSession = decrypted.split( &#x27;;&#x27; );
            _intermed = {
                id: cookieSession[ 0 ],
                usuarioUrl: cookieSession[ 1 ],
                tipoUsuario: cookieSession[ 2 ]
            }
        } catch ( e ) {
            console.log( &#x27;Error en var session: &#x27; + e );
        }
        return _intermed;
    }

    io.on( &#x27;connection&#x27;, function ( socket ) {
        socket.request.session = intermed_sesion( socket );
        if ( socket.request.session.id &#x3E; 0 ) {

            socket.on( &#x27;disconnect&#x27;, function () {
                desconectar( socket.id );
                //console.log(&#x27;[desconectar]Usuarios conectados: &#x27; + JSON.stringify(conectados));
                //console.log( &#x27;[DESCONEXI&#xD3;N:&#x27; + socket.id + &#x27;]USUARIO:&#x27; + socket.request.session.usuario + &#x27;.&#x27; );
            } );

            socket.on( &#x27;verNotificaciones&#x27;, function () {
                //console.log( &#x27;socket_id: &#x27; + socket.id + &#x27; [Buscar: verNotificaciones]&#x27; );
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    tipoUsuario: socket.request.session.tipoUsuario
                };

                intermed.callController( &#x27;notificaciones&#x27;, &#x27;verNotificaciones&#x27;, req );
            } );

            socket.on( &#x27;verNotificacionesInbox&#x27;, function () {
                //console.log( &#x27;socket_id: &#x27; + socket.id + &#x27; [Buscar: verNotificaciones]&#x27; );
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    tipoUsuario: socket.request.session.tipoUsuario
                };

                intermed.callController( &#x27;notificaciones&#x27;, &#x27;verNotificacionesInbox&#x27;, req );
            } );

            socket.on( &#x27;verComentarios&#x27;, function () {
                //console.log( &#x27;socket_id: &#x27; + socket.id + &#x27; [Buscar: verNotificaciones]&#x27; );
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    tipoUsuario: socket.request.session.tipoUsuario
                };

                intermed.callController( &#x27;notificaciones&#x27;, &#x27;verComentarios&#x27;, req );
            } );

            socket.on( &#x27;inbox&#x27;, function () {
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    tipoUsuario: socket.request.session.tipoUsuario
                };

                intermed.callController( &#x27;notificaciones&#x27;, &#x27;inbox&#x27;, req );
            } );

            socket.on( &#x27;conectarSocket&#x27;, function () {
                console.log( &#x27;[CONEXI&#xD3;N:&#x27; + socket.id + &#x27;]ID:&#x27; + socket.request.session.id + &#x27;.&#x27; );
                conectados.push( {
                    socket: socket.id,
                    id: socket.request.session.id,
                    usuario: socket.request.session.usuario,
                    tipoUsuario: socket.request.session.tipoUsuario
                } );

                //console.log(&#x27;Usuarios conectados: &#x27; + JSON.stringify(conectados));
            } );

            socket.on( &#x27;enviarInbox&#x27;, function ( data ) {
                var SocketsConectados = indexOfUsuarioId( data.para );
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    tipoUsuario: socket.request.session.tipoUsuario,
                    info: data,
                    SocketsConectados: SocketsConectados
                };
                intermed.callController( &#x27;inbox&#x27;, &#x27;enviar&#x27;, req );
            } )

            socket.on( &#x27;conversacionLeida&#x27;, function ( usuario_id ) {
                var req = {
                    socket: socket,
                    usuario_id_para: socket.request.session.id,
                    usuario_id_de: usuario_id
                };
                intermed.callController( &#x27;inbox&#x27;, &#x27;conversacionLeida&#x27;, req );
            } )

            socket.on( &#x27;crearConversacion&#x27;, function ( usuario_id, append ) {
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    usuario_id_de: usuario_id,
                    append: append
                };
                intermed.callController( &#x27;inbox&#x27;, &#x27;crearConversacion&#x27;, req );
            } );

            socket.on( &#x27;cargarInboxVistaPrevia&#x27;, function ( object ) {
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id
                };
                if ( object ) {
                    req.notIn = object.notIn
                }
                intermed.callController( &#x27;inbox&#x27;, &#x27;cargarInboxVistaPrevia&#x27;, req );
            } );

            socket.on( &#x27;obtenerUsuarioId&#x27;, function ( object ) {
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    UsuarioUrl: object
                };
                intermed.callController( &#x27;usuarios&#x27;, &#x27;obtenerUsuarioId&#x27;, req );
            } );

            socket.on( &#x27;contarNuevasNotificaciones&#x27;, function ( object ) {
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    UsuarioUrl: object
                };

                models.TipoNotificacion.findAll( {
                    where: {
                        tipoUsuario: socket.request.session.tipoUsuario
                    }
                } ).
                then( function ( result ) {
                    models.ConfNotUsu.findAll( {
                        where: {
                            usuario_id: req.usuario_id
                        }
                    } ).then( function ( confPersonal ) {
                        for ( var key in confPersonal ) {
                            for ( var key2 in result ) {
                                if ( result[ key2 ].configurable === 1 ) {
                                    if ( result[ key2 ].id === confPersonal[ key ].tipoNotificacion_id ) {
                                        result[ key2 ].interno = confPersonal[ key ].interno;
                                        result[ key2 ].push = confPersonal[ key ].push;
                                        result[ key2 ].mail = confPersonal[ key ].mail;
                                    }
                                }
                            }
                        }
                        var notificaciones = [];
                        for ( var key in result ) {
                            if ( result[ key ].interno == 1 ) {
                                notificaciones.push( result[ key ].id );
                            }
                        }
                        if ( notificaciones.length &#x3E; 0 ) {
                            var req = {
                                socket: socket,
                                usuario_id: socket.request.session.id,
                                tipoUsuario: socket.request.session.tipoUsuario,
                                notificaciones: notificaciones
                            };
                            intermed.callController( &#x27;notificaciones&#x27;, &#x27;contarNuevasNotificaciones&#x27;, req );
                        }
                    } )
                } );
            } );

            socket.on( &#x27;buscarNotificaciones&#x27;, function ( object ) {
                var req = {
                    socket: socket,
                    usuario_id: socket.request.session.id,
                    UsuarioUrl: object
                };

                models.TipoNotificacion.findAll( {
                    where: {
                        tipoUsuario: socket.request.session.tipoUsuario
                    }
                } ).
                then( function ( result ) {
                    models.ConfNotUsu.findAll( {
                        where: {
                            usuario_id: socket.request.session.id
                        }
                    } ).then( function ( confPersonal ) {
                        for ( var key in confPersonal ) {
                            for ( var key2 in result ) {
                                if ( result[ key2 ].configurable === 1 ) {
                                    if ( result[ key2 ].id === confPersonal[ key ].tipoNotificacion_id ) {
                                        result[ key2 ].interno = confPersonal[ key ].interno;
                                        result[ key2 ].push = confPersonal[ key ].push;
                                        result[ key2 ].mail = confPersonal[ key ].mail;
                                    }
                                }
                            }
                        }
                        var notificaciones = [];
                        for ( var key in result ) {
                            if ( result[ key ].interno == 1 ) {
                                notificaciones.push( result[ key ].id );
                            }
                        }
                        if ( notificaciones.length &#x3E; 0 ) {
                            var req = {
                                socket: socket,
                                usuario_id: socket.request.session.id,
                                tipoUsuario: socket.request.session.tipoUsuario,
                                notificaciones: notificaciones
                            };
                            intermed.callController( &#x27;notificaciones&#x27;, &#x27;buscarNotificaciones&#x27;, req );
                        }
                    } )
                } );
            } );

            socket.on( &#x27;notificacionesScroll&#x27;, function ( object, maxfecha ) {
                models.TipoNotificacion.findAll( {
                    where: {
                        tipoUsuario: socket.request.session.tipoUsuario
                    }
                } ).
                then( function ( result ) {
                    models.ConfNotUsu.findAll( {
                        where: {
                            usuario_id: socket.request.session.id
                        }
                    } ).then( function ( confPersonal ) {
                        for ( var key in confPersonal ) {
                            for ( var key2 in result ) {
                                if ( result[ key2 ].configurable === 1 ) {
                                    if ( result[ key2 ].id === confPersonal[ key ].tipoNotificacion_id ) {
                                        result[ key2 ].interno = confPersonal[ key ].interno;
                                        result[ key2 ].push = confPersonal[ key ].push;
                                        result[ key2 ].mail = confPersonal[ key ].mail;
                                    }
                                }
                            }
                        }
                        var notificaciones = [];
                        for ( var key in result ) {
                            if ( result[ key ].interno == 1 ) {
                                notificaciones.push( result[ key ].id );
                            }
                        }
                        if ( notificaciones.length &#x3E; 0 ) {
                            var req = {
                                socket: socket,
                                usuario_id: socket.request.session.id,
                                tipoUsuario: socket.request.session.tipoUsuario,
                                notificaciones: notificaciones,
                                notificacionesId: object,
                                maxfecha: maxfecha
                            };
                            intermed.callController( &#x27;notificaciones&#x27;, &#x27;notificacionesScroll&#x27;, req );
                        }
                    } )
                } );
            } );

            socket.on( &#x27;traerNuevasNotificaciones&#x27;, function () {
                models.TipoNotificacion.findAll( {
                    where: {
                        tipoUsuario: socket.request.session.tipoUsuario
                    }
                } ).
                then( function ( result ) {
                    models.ConfNotUsu.findAll( {
                        where: {
                            usuario_id: socket.request.session.id
                        }
                    } ).then( function ( confPersonal ) {
                        for ( var key in confPersonal ) {
                            for ( var key2 in result ) {
                                if ( result[ key2 ].configurable === 1 ) {
                                    if ( result[ key2 ].id === confPersonal[ key ].tipoNotificacion_id ) {
                                        result[ key2 ].interno = confPersonal[ key ].interno;
                                        result[ key2 ].push = confPersonal[ key ].push;
                                        result[ key2 ].mail = confPersonal[ key ].mail;
                                    }
                                }
                            }
                        }
                        var notificaciones = [];
                        for ( var key in result ) {
                            if ( result[ key ].interno == 1 ) {
                                notificaciones.push( result[ key ].id );
                            }
                        }
                        if ( notificaciones.length &#x3E; 0 ) {
                            var req = {
                                socket: socket,
                                usuario_id: socket.request.session.id,
                                tipoUsuario: socket.request.session.tipoUsuario,
                                notificaciones: notificaciones
                            };
                            intermed.callController( &#x27;notificaciones&#x27;, &#x27;traerNuevasNotificaciones&#x27;, req );
                        }
                    } )
                } );
            } );

            socket.on( &#x27;cargarNotificacionesList&#x27;, function ( notificacionesId, limit, maxfecha ) {

                models.TipoNotificacion.findAll( {
                    where: {
                        tipoUsuario: socket.request.session.tipoUsuario
                    }
                } ).
                then( function ( result ) {
                    models.ConfNotUsu.findAll( {
                        where: {
                            usuario_id: socket.request.session.id
                        }
                    } ).then( function ( confPersonal ) {
                        for ( var key in confPersonal ) {
                            for ( var key2 in result ) {
                                if ( result[ key2 ].configurable === 1 ) {
                                    if ( result[ key2 ].id === confPersonal[ key ].tipoNotificacion_id ) {
                                        result[ key2 ].interno = confPersonal[ key ].interno;
                                        result[ key2 ].push = confPersonal[ key ].push;
                                        result[ key2 ].mail = confPersonal[ key ].mail;
                                    }
                                }
                            }
                        }
                        var notificaciones = [];
                        for ( var key in result ) {
                            if ( result[ key ].interno == 1 ) {
                                notificaciones.push( result[ key ].id );
                            }
                        }
                        if ( notificaciones.length &#x3E; 0 ) {
                            var req = {
                                socket: socket,
                                usuario_id: socket.request.session.id,
                                tipoUsuario: socket.request.session.tipoUsuario,
                                notificaciones: notificaciones,
                                maxfecha: maxfecha,
                                limit: limit,
                                notificacionesId: notificacionesId
                            };
                            intermed.callController( &#x27;notificaciones&#x27;, &#x27;cargarNotificacionesList&#x27;, req );
                        }
                    } )
                } );
            } );
        }
    } );
};

//se importa para que otros js lo puedan ejecutar
exports.io = io;</code>

                                        </pre>
                                    </div>
                                </div>

                            </section><!--//doc-section-->
                            <section id="callouts-section" class="doc-section">
                                <h2 class="section-title">Callouts</h2>
                                <div class="section-block">
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo.
                                    </p>
                                </div>

                                <div class="section-block">
                                    <div class="callout-block callout-info">
                                        <div class="icon-holder">
                                            <i class="fa fa-info-circle"></i>
                                        </div><!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Aenean imperdiet</h4>
                                            <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium <code>&lt;code&gt;</code> , Nemo enim ipsam voluptatem quia voluptas <a href="#">link example</a> sit aspernatur aut odit aut fugit.</p>
                                        </div><!--//content-->
                                    </div><!--//callout-block-->

                                    <div class="callout-block callout-warning">
                                        <div class="icon-holder">
                                            <i class="fa fa-bug"></i>
                                        </div><!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Morbi posuere</h4>
                                            <p>Nunc hendrerit odio quis dignissim efficitur. Proin ut finibus libero. Morbi posuere fringilla felis eget sagittis. Fusce sem orci, cursus in tortor <a href="#">link example</a> tellus vel diam viverra elementum.</p>
                                        </div><!--//content-->
                                    </div><!--//callout-block-->

                                    <div class="callout-block callout-success">
                                        <div class="icon-holder">
                                            <i class="fa fa-thumbs-up"></i>
                                        </div><!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Lorem ipsum dolor sit amet</h4>
                                            <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. <a href="#">Link example</a> aenean commodo ligula eget dolor.</p>
                                        </div><!--//content-->
                                    </div><!--//callout-block-->

                                    <div class="callout-block callout-danger">
                                        <div class="icon-holder">
                                            <i class="fa fa-exclamation-triangle"></i>
                                        </div><!--//icon-holder-->
                                        <div class="content">
                                            <h4 class="callout-title">Interdum et malesuada</h4>
                                            <p>Morbi eget interdum sapien. Donec sed turpis sed nulla lacinia accumsan vitae ut tellus. Aenean vestibulum <a href="#">Link example</a> maximus ipsum vel dignissim. Morbi ornare elit sit amet massa feugiat, viverra dictum ipsum pellentesque. </p>
                                        </div><!--//content-->
                                    </div><!--//callout-block-->
                                </div>
                            </section><!--//doc-section-->
                            <section id="tables-section" class="doc-section">
                                <h2 class="section-title">Tables</h2>
                                <div class="section-block">
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis.
                                    </p>
                                </div>
                                <div class="section-block">
                                    <h6>Basic Table</h6>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>First Name</th>
                                                    <th>Last Name</th>
                                                    <th>Username</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">1</th>
                                                    <td>Mark</td>
                                                    <td>Otto</td>
                                                    <td>@mdo</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">2</th>
                                                    <td>Jacob</td>
                                                    <td>Thornton</td>
                                                    <td>@fat</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">3</th>
                                                    <td>Larry</td>
                                                    <td>the Bird</td>
                                                    <td>@twitter</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div><!--//table-responsive-->
                                    <h6>Bordered Table</h6>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>First Name</th>
                                                    <th>Last Name</th>
                                                    <th>Username</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">1</th>
                                                    <td>Mark</td>
                                                    <td>Otto</td>
                                                    <td>@mdo</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">2</th>
                                                    <td>Jacob</td>
                                                    <td>Thornton</td>
                                                    <td>@fat</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">3</th>
                                                    <td>Larry</td>
                                                    <td>the Bird</td>
                                                    <td>@twitter</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div><!--//table-responsive-->
                                    <h6>Striped Table</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>First Name</th>
                                                    <th>Last Name</th>
                                                    <th>Username</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <th scope="row">1</th>
                                                    <td>Mark</td>
                                                    <td>Otto</td>
                                                    <td>@mdo</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">2</th>
                                                    <td>Jacob</td>
                                                    <td>Thornton</td>
                                                    <td>@fat</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row">3</th>
                                                    <td>Larry</td>
                                                    <td>the Bird</td>
                                                    <td>@twitter</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div><!--//table-responsive-->
                                </div><!--//section-block-->
                            </section><!--//doc-section-->
                            <section id="buttons-section" class="doc-section">
                                <h2 class="section-title">Buttons</h2>
                                <div class="section-block">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi nec imperdiet turpis. Curabitur aliquet pulvinar ultrices. Etiam at posuere leo. Proin ultrices ex et dapibus feugiat <a href="#">link example</a> aenean purus leo, faucibus at elit vel, aliquet scelerisque dui. Etiam quis elit euismod, imperdiet augue sit amet, imperdiet odio. Aenean sem erat, hendrerit  eu gravida id, dignissim ut ante. Nam consequat porttitor libero euismod congue.
                                    </p>
                                    <div class="row">
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <h6>Basic Buttons</h6>
                                            <ul class="list list-unstyled">
                                                <li><a href="#" class="btn btn-primary">Primary Button</a></li>
                                                <li><a href="#" class="btn btn-green">Green Button</a></li>
                                                <li><a href="#" class="btn btn-blue">Blue Button</a></li>
                                                <li><a href="#" class="btn btn-orange">Orange Button</a></li>
                                                <li><a href="#" class="btn btn-red">Red Button</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <h6>CTA Buttons</h6>
                                            <ul class="list list-unstyled">
                                                <li><a href="#" class="btn btn-primary btn-cta"><i class="fa fa-download"></i> Download Now</a></li>
                                                <li><a href="#" class="btn btn-green btn-cta"><i class="fa fa-code-fork"></i> Fork Now</a></li>
                                                <li><a href="#" class="btn btn-blue btn-cta"><i class="fa fa-play-circle"></i> Find Out Now</a></li>
                                                <li><a href="#" class="btn btn-orange btn-cta"><i class="fa fa-bug"></i> Report Bugs</a></li>
                                                <li><a href="#" class="btn btn-red btn-cta"><i class="fa fa-exclamation-circle"></i> Submit Issues</a></li>
                                            </ul>
                                        </div>
                                    </div><!--//row-->
                                </div><!--//section-block-->
                            </section><!--//doc-section-->
                        </div><!--//content-inner-->
                    </div><!--//doc-content-->
                    <div class="doc-sidebar hidden-xs">
                        <nav id="doc-nav">
                            <ul id="doc-menu" class="nav doc-menu" data-spy="affix">
                                <li><a class="scrollto" href="#intro-section">Intro</a></li>
                                <li>
                                    <a class="scrollto" href="#installation-section">Instalación</a>
                                    <ul class="nav doc-sub-menu">
                                        <li><a class="scrollto" href="#step1">Paso 1</a></li>
                                        <li><a class="scrollto" href="#step2">Paso 2</a></li>
                                        <li><a class="scrollto" href="#step3">Paso 3</a></li>
                                    </ul><!--//nav-->
                                </li>
                                <li>
                                    <a class="scrollto" href="#server-section">Server</a>
                                </li>
                                <li>
                                    <a class="scrollto" href="#mvc-section">MVC</a>
                                    <ul class="nav doc-sub-menu">
                                        <li><a class="scrollto" href="#appjs">app.js</a></li>
                                        <li><a class="scrollto" href="#routerjs">router.js</a></li>
                                    </ul><!--//nav-->
                                </li>
                                <li><a class="scrollto" href="#callouts-section">Callouts</a></li>
                                <li><a class="scrollto" href="#tables-section">Tables</a></li>
                                <li><a class="scrollto" href="#buttons-section">Buttons</a></li>
                                <li><a class="scrollto" href="#video-section">Video</a></li>
                                <li><a class="scrollto" href="#icons-section">Icons</a></li>
                            </ul><!--//doc-menu-->
                        </nav>
                    </div><!--//doc-sidebar-->
                </div><!--//doc-body-->
            </div><!--//container-->
        </div><!--//doc-wrapper-->

        <div id="promo-block" class="promo-block">
            <div class="container">
                <div class="promo-block-inner">
                    <h3 class="promo-title text-center"><i class="fa fa-heart"></i> <a href="https://wrapbootstrap.com/theme/appkit-admin-theme-angularjs-WB051SCJ1?ref=3wm" target="_blank">AppKit - Bootstrap Angular Admin Theme for Developers</a></h3>
                    <div class="row">
                        <div class="figure-holder col-md-5 col-sm-6 col-xs-12">
                            <div class="figure-holder-inner">
                                <a href="https://wrapbootstrap.com/theme/appkit-admin-theme-angularjs-WB051SCJ1?ref=3wm" target="_blank"><img class="img-responsive" src="assets/images/demo/appkit-widgets-thumb.jpg" alt="AppKit Theme" /></a>
                                <a class="mask" href="#hook"><i class="icon fa fa-heart pink"></i></a>

                            </div>
                        </div><!--//figure-holder-->
                        <div class="content-holder col-md-7 col-sm-6 col-xs-12">
                            <div class="content-holder-inner">
                                <div class="desc">
                                    <h4 class="content-title"><strong>Love this free documentation theme?</strong></h4>
                                    <p>Check out AppKit - an Angular admin theme I created with my developer friend <a href="https://twitter.com/tnajdek">Tom Najdek</a> for developers. AppKit uses modern front-end technologies and is packed with useful components and widgets to speed up your app development.</p>
                                    <p><strong class="highlight">[Tip for developers]:</strong> If your project is Open Source, you can use this area to promote your other projects or hold third party adverts like Bootstrap and FontAwesome do!</p>
                                </div><!--//desc-->
                                <div class="author"><a href="http://themes.3rdwavemedia.com">Xiaoying Riley</a></div>
                            </div><!--//content-holder-inner-->
                        </div><!--//content-holder-->
                    </div><!--//row-->
                </div><!--//promo-block-inner-->
            </div><!--//container-->
        </div><!--//promo-block-->

    </div><!--//page-wrapper-->

    <footer id="footer" class="footer text-center">
        <div class="container">
            <!--/* This template is released under the Creative Commons Attribution 3.0 License. Please keep the attribution link below when using for your own project. Thank you for your support. :) If you'd like to use the template without the attribution, you can check out other license options via our website: themes.3rdwavemedia.com */-->
            <small class="copyright">Designed with <i class="fa fa-heart"></i> by <a href="http://themes.3rdwavemedia.com/" targe="_blank">Xiaoying Riley</a> for developers</small>

        </div><!--//container-->
    </footer><!--//footer-->


    <!-- Main Javascript -->
    <script type="text/javascript" src="assets/plugins/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/plugins/prism/prism.js"></script>
    <script type="text/javascript" src="assets/plugins/jquery-scrollTo/jquery.scrollTo.min.js"></script>
    <script type="text/javascript" src="assets/plugins/lightbox/dist/ekko-lightbox.min.js"></script>
    <script type="text/javascript" src="assets/plugins/jquery-match-height/jquery.matchHeight-min.js"></script>
    <script type="text/javascript" src="assets/js/main.js"></script>

</body>
</html>
